{"version":3,"file":"blacklight_range_limit.js","sources":["../../../javascript/blacklight_range_limit/range_limit_slider.js","../../../javascript/blacklight_range_limit/index.js"],"sourcesContent":["// for Blacklight.onLoad:\n\nconst RangeLimitSlider = {\n  initialize: function(modalSelector) {\n    $(\".range_limit .profile .range.slider_js\").each(function() {\n      BlacklightRangeLimit.buildSlider(this);\n    });\n\n    $(modalSelector).on('shown.bs.modal', function() {\n      $(this).find(\".range_limit .profile .range.slider_js\").each(function() {\n        BlacklightRangeLimit.buildSlider(this);\n      });\n    });\n\n    // catch event for redrawing chart, to redraw slider to match width\n    $(\"body\").on(\"plotDrawn.blacklight.rangeLimit\", function(event) {\n      var area       = $(event.target).closest(\".limit_content.range_limit\");\n      var plot       = area.find(\".chart_js\").data(\"plot\");\n      var slider_el  = area.find(\".slider\");\n\n      if (plot && slider_el) {\n        slider_el.width(plot.width());\n        slider_el.css(\"display\", \"block\")\n      }\n    });\n  }\n}\n\n// returns two element array min/max as numbers. If there is a limit applied,\n// it's boundaries are are limits. Otherwise, min/max in current result\n// set as sniffed from HTML. Pass in a DOM element for a div.range\n// Will return NaN as min or max in case of error or other weirdness.\nBlacklightRangeLimit.min_max = function min_max(range_element) {\n  var current_limit =  $(range_element).closest(\".limit_content.range_limit\").find(\".current\")\n  let min, max\n  min = max = BlacklightRangeLimit.parseNum(current_limit.find(\".single\").data('blrlSingle'))\n  if ( isNaN(min)) {\n    min = BlacklightRangeLimit.parseNum(current_limit.find(\".from\").first().data('blrlBegin'));\n    max = BlacklightRangeLimit.parseNum(current_limit.find(\".to\").first().data('blrlEnd'));\n  }\n\n  if (isNaN(min) || isNaN(max)) {\n    //no current limit, take from results min max included in spans\n    min = BlacklightRangeLimit.parseNum($(range_element).find(\".min\").first().text());\n    max = BlacklightRangeLimit.parseNum($(range_element).find(\".max\").first().text());\n  }\n  return [min, max]\n}\n\n\n// Check to see if a value is an Integer\n// see: http://stackoverflow.com/questions/3885817/how-to-check-if-a-number-is-float-or-integer\nBlacklightRangeLimit.isInt = function isInt(n) {\n  return n % 1 === 0;\n}\n\nBlacklightRangeLimit.buildSlider = function buildSlider(thisContext) {\n    var range_element = $(thisContext);\n\n    var boundaries = BlacklightRangeLimit.min_max(thisContext);\n    var min = boundaries[0];\n    var max = boundaries[1];\n\n    if (BlacklightRangeLimit.isInt(min) && BlacklightRangeLimit.isInt(max)) {\n      $(thisContext).contents().wrapAll('<div class=\"sr-only visually-hidden\" />');\n\n      var range_element = $(thisContext);\n      var form = $(range_element).closest(\".range_limit\").find(\"form.range_limit\");\n      var begin_el = form.find(\"input.range_begin\");\n      var end_el = form.find(\"input.range_end\");\n\n      var placeholder_input = $('<input type=\"hidden\" data-slider-placeholder=\"true\" />').appendTo(range_element);\n\n      // make sure slider is loaded\n      if (placeholder_input.slider !== undefined) {\n        placeholder_input.slider({\n          min: min,\n          max: max,\n          value: [min, max],\n          tooltip: \"hide\"\n        });\n\n        // try to make slider width/orientation match chart's\n        var container = range_element.closest(\".range_limit\");\n        var plot_el = container.find(\".chart_js\");\n        var plot = plot_el.data(\"plot\");\n        var slider_el = container.find(\".slider\");\n\n        if (plot_el) {\n          plot_el.attr('aria-hidden', 'true');\n        }\n\n        if (slider_el) {\n          slider_el.attr('aria-hidden', 'true');\n        }\n\n        if (plot && slider_el) {\n          slider_el.width(plot.width());\n          slider_el.css(\"display\", \"block\")\n        } else if (slider_el) {\n          slider_el.css(\"width\", \"100%\");\n        }\n      }\n\n      // Slider change should update text input values.\n      var parent = $(thisContext).parent();\n      var form = $(parent).closest(\".limit_content\").find(\"form.range_limit\");\n      $(parent).closest(\".limit_content\").find(\".profile .range\").on(\"slide\", function(event, ui) {\n        var values = $(event.target).data(\"slider\").getValue();\n        form.find(\"input.range_begin\").val(values[0]);\n        form.find(\"input.range_end\").val(values[1]);\n      });\n    }\n\n    begin_el.val(min);\n    end_el.val(max);\n\n    begin_el.on('input', function() {\n      var val = BlacklightRangeLimit.parseNum(this.value);\n      if (isNaN(val) || val < min) {\n        //for weird data, set slider at min\n        val = min;\n      }\n      var values = placeholder_input.data(\"slider\").getValue();\n      values[0] = val;\n      placeholder_input.slider(\"setValue\", values);\n    });\n\n    end_el.on('input', function() {\n      var val = BlacklightRangeLimit.parseNum(this.value);\n      if (isNaN(val) || val > max) {\n        //weird entry, set slider to max\n        val = max;\n      }\n      var values = placeholder_input.data(\"slider\").getValue();\n      values[1] = val;\n      placeholder_input.slider(\"setValue\", values);\n    });\n\n    begin_el.change(function() {\n      var val1 = BlacklightRangeLimit.parseNum(begin_el.val());\n      var val2 = BlacklightRangeLimit.parseNum(end_el.val());\n\n      if (val2 < val1) {\n        begin_el.val(val2);\n        end_el.val(val1);\n      }\n    });\n\n    end_el.change(function() {\n      var val1 = BlacklightRangeLimit.parseNum(begin_el.val());\n      var val2 = BlacklightRangeLimit.parseNum(end_el.val());\n\n      if (val2 < val1) {\n        begin_el.val(val2);\n        end_el.val(val1);\n      }\n    });\n  }\n\nexport default RangeLimitSlider;","// Master manifest file for engine, so local app can require\n// this one file, but get all our files -- and local app\n// require does not need to change if we change file list.\n//\n// Note JQuery is required to be loaded for flot and blacklight_range_limit\n// JS to work, expect host app to load it.\n\n\n//= require 'flot/jquery.canvaswrapper.js'\n//= require 'flot/jquery.colorhelpers.js'\n//= require 'flot/jquery.flot.js'\n//= require 'flot/jquery.flot.browser.js'\n//= require 'flot/jquery.flot.saturated.js'\n//= require 'flot/jquery.flot.drawSeries.js'\n//= require 'flot/jquery.event.drag.js'\n//= require 'flot/jquery.flot.hover.js'\n//= require 'flot/jquery.flot.uiConstants.js'\n//= require 'flot/jquery.flot.selection.js'\n//= require 'bootstrap-slider'\n\nimport RangeLimitDistroFacet from 'range_limit_distro_facet';\nimport RangeLimitSlider from 'range_limit_slider';\n\n// Ensure that range_limit_shared is loaded first\n//= require 'blacklight_range_limit/range_limit_shared'\n//= require 'blacklight_range_limit/range_limit_plotting'\n//= require 'blacklight_range_limit/range_limit_slider'\n//= require 'blacklight_range_limit/range_limit_distro_facets'\n\nBlacklightRangeLimit.initialize = function() {\n  // Support for Blacklight 7 and 8:\n  const modalSelector = Blacklight.modal?.modalSelector || Blacklight.Modal.modalSelector \n\n  RangeLimitDistroFacet.initialize(modalSelector)\n  RangeLimitSlider.initialize(modalSelector)\n}\n\n// Blacklight will only be defined if you aren't using this in a module context\nif (Blacklight)\n  Blacklight.onLoad(() => BlacklightRangeLimit.initialize())\n\n// In a module context you can do:\n//   import BlacklightRangeLimit from 'blacklight_range_limit'\n//   Blacklight.onLoad(() => BlacklightRangeLimit.initialize())\nexport default BlacklightRangeLimit"],"names":["RangeLimitDistroFacet"],"mappings":"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"}